<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>User Management</title>
    <link rel="icon" href="{{ url_for('static', filename='SLK Logo.png') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
      body {
        margin: 0;
        background: url("{{ url_for('static', filename='background.jpg') }}") no-repeat center center fixed;
        background-size: cover;
        font-family: 'Montserrat', sans-serif;
      }
      .panel {
        background: rgba(255, 255, 255, 0.94);
        border-radius: 14px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }
      .table td, .table th {
        vertical-align: middle;
      }
      .form-inline-controls {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
    </style>
  </head>
  <body>
    <div class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 text-success mb-0">User Management</h1>
        <div class="d-flex gap-2">
          <a class="btn btn-outline-success" href="{{ url_for('vehicle_stats') }}"><i class="fas fa-car-side"></i> Vehicle Stats</a>
          <a class="btn btn-outline-secondary" href="{{ url_for('logout') }}"><i class="fas fa-arrow-right-from-bracket"></i> Logout</a>
        </div>
      </div>

      {% if success_message %}
        <div class="alert alert-success">{{ success_message }}</div>
      {% endif %}
      {% if error_message %}
        <div class="alert alert-danger">{{ error_message }}</div>
      {% endif %}

      <div class="panel p-4 mb-4">
        <h2 class="h5 text-success mb-3">Add User</h2>
        <form method="post" class="row g-3">
          <input type="hidden" name="action" value="add">
          <div class="col-md-4">
            <label class="form-label">Username</label>
            <input class="form-control" type="text" name="username" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">Password</label>
            <input class="form-control" type="password" name="password" required>
          </div>
          <div class="col-md-2 d-flex align-items-end">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="is_admin" id="is_admin_add">
              <label class="form-check-label" for="is_admin_add">Admin</label>
            </div>
          </div>
          <div class="col-md-2 d-flex align-items-end">
            <button class="btn btn-success w-100" type="submit">Create</button>
          </div>
        </form>
      </div>

      <div class="panel p-4">
        <h2 class="h5 text-success mb-3">Existing Users</h2>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>User</th>
                <th>Role</th>
                <th>Update</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody>
              {% for user in users %}
                <tr>
                  <td><strong>{{ user.username }}</strong></td>
                  <td>{{ 'Admin' if user.is_admin else 'User' }}</td>
                  <td>
                    <form method="post" class="form-inline-controls">
                      <input type="hidden" name="action" value="update">
                      <input type="hidden" name="username" value="{{ user.username }}">
                      <input class="form-control" type="password" name="password" placeholder="New password (optional)">
                      <div class="form-check d-flex align-items-center">
                        <input class="form-check-input me-1" type="checkbox" name="is_admin" id="admin_{{ loop.index }}" {% if user.is_admin %}checked{% endif %}>
                        <label class="form-check-label" for="admin_{{ loop.index }}">Admin</label>
                      </div>
                      <button class="btn btn-outline-success btn-sm" type="submit">Save</button>
                    </form>
                  </td>
                  <td>
                    <form method="post" onsubmit="return confirm('Delete user {{ user.username }}?');">
                      <input type="hidden" name="action" value="delete">
                      <input type="hidden" name="username" value="{{ user.username }}">
                      <button class="btn btn-outline-danger btn-sm" type="submit">Delete</button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
</html>
